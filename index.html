<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vocabulary Trainer</title>
  <style>
    :root {
      --bg: #0f172a;       /* slate-900 */
      --card: #111827;     /* gray-900 */
      --muted: #94a3b8;    /* slate-400 */
      --fg: #e5e7eb;       /* gray-200 */
      --accent: #22c55e;   /* green-500 */
      --accent-press: #16a34a; /* green-600 */
      --btn: #1f2937;      /* gray-800 */
      --btn-active: #111827;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 700px at 50% -100px, #1e293b 20%, var(--bg) 60%);
      color: var(--fg);
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      display: grid;
      place-items: start center;
      padding: 16px;
    }
    .app {
      width: 100%;
      max-width: 720px;
      display: grid;
      gap: 14px;
    }
    header h1 {
      margin: 0;
      font-size: clamp(22px, 5vw, 28px);
      letter-spacing: 0.5px;
      text-align: center;
      color: #f8fafc;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }
    @media (max-width: 420px) {
      .controls { grid-template-columns: 1fr 1fr; }
      .controls .wide { grid-column: 1 / -1; }
    }
    button {
      -webkit-tap-highlight-color: transparent;
      appearance: none;
      border: 1px solid #334155;
      background: var(--btn);
      color: var(--fg);
      border-radius: 12px;
      padding: 12px 14px;
      font-weight: 600;
      letter-spacing: .2px;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
    }
    button:active { transform: translateY(1px); }
    .primary { background: var(--accent); border-color: var(--accent); color: #04110a; }
    .primary:active { background: var(--accent-press); border-color: var(--accent-press); }
    .toggle[aria-pressed="true"] {
      background: var(--btn-active);
      border-color: #475569;
      outline: 2px solid #334155;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.25));
      border: 1px solid rgba(148,163,184,.25);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 14px;
      display: grid;
      gap: 10px;
    }

    /* Topic area — BIG, never truncated */
    .topic {
      display: grid;
      gap: 6px;
    }
    .topic-label {
      font-size: 12px;
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.12em;
    }
    .topic-de {
      /* Large, wraps freely */
      font-size: clamp(20px, 6.2vw, 28px);
      line-height: 1.15;
      font-weight: 800;
      word-break: break-word;
      overflow-wrap: anywhere;
      white-space: normal;
      margin: 0;
    }
    .topic-en {
      font-size: 14px;
      color: var(--muted);
      margin: 0;
      display: none;
    }

    /* Content blocks */
    .content {
      display: grid;
      gap: 8px;
      margin-top: 2px;
    }
    .content-block {
      background: var(--card);
      border: 1px solid rgba(148,163,184,.25);
      border-radius: 12px;
      padding: 12px;
      display: grid;
      gap: 6px;
    }
    .content-title {
      font-size: 12px;
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.12em;
    }
    .content-de, .content-en {
      margin: 0;
      font-size: clamp(16px, 4.5vw, 18px);
      line-height: 1.35;
      word-break: break-word;
      overflow-wrap: anywhere;
      white-space: pre-wrap; /* conserva saltos si los hay */
    }
    .content-en { display: none; color: #d1fae5; }

    /* When translation is toggled on */
    .show-translation .topic-en,
    .show-translation .content-en { display: block; }
    .show-translation .toggle::after { content: " (on)"; font-weight: 500; }

    /* Toast / status */
    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
      font-size: 14px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0;
    }
  </style>
</head>
<body>
  <main class="app" id="app" hidden>
    <header>
      <h1>Vocabulary Trainer</h1>
    </header>

    <div class="controls">
      <button id="newBtn" class="primary wide">Draw random</button>
      <button id="toggleTrBtn" class="toggle" aria-pressed="false">Show translation</button>
      <button id="copyBtn">Copy to clipboard</button>
    </div>

    <section class="card" aria-live="polite">
      <div class="topic">
        <span class="topic-label">Topic</span>
        <h2 id="topicDe" class="topic-de">—</h2>
        <p id="topicEn" class="topic-en">—</p>
      </div>

      <div class="content">
        <div class="content-block">
          <div class="content-title">German (to explain)</div>
          <p id="contentDe" class="content-de">—</p>
        </div>
        <div class="content-block">
          <div class="content-title">English translation</div>
          <p id="contentEn" class="content-en">—</p>
        </div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="srStatus" class="sr-only" aria-live="polite"></div>

  <script>
    const el = (id) => document.getElementById(id);
    const app = el('app');
    const topicDe = el('topicDe');
    const topicEn = el('topicEn');
    const contentDe = el('contentDe');
    const contentEn = el('contentEn');
    const newBtn = el('newBtn');
    const toggleTrBtn = el('toggleTrBtn');
    const copyBtn = el('copyBtn');
    const toast = el('toast');
    const srStatus = el('srStatus');

    let DATA = [];

    // Robust TSV parser for 4 columns: [topic_de, topic_en, content_de, content_en]
    function parseTSV(text) {
      return text
        .replace(/^\uFEFF/, '')        // strip BOM if present
        .split(/\r?\n/)
        .map(l => l.trim())
        .filter(l => l.length > 0)
        .map(line => {
          const cols = line.split('\t');
          // Fill missing cols with empty strings to avoid undefined
          while (cols.length < 4) cols.push('');
          return {
            topic_de: cols[0] || '',
            topic_en: cols[1] || '',
            content_de: cols[2] || '',
            content_en: cols[3] || ''
          };
        });
    }

    function randomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function showItem(item) {
      topicDe.textContent = item.topic_de || '—';
      topicEn.textContent = item.topic_en || '—';
      contentDe.textContent = item.content_de || '—';
      contentEn.textContent = item.content_en || '—';
    }

    function setTranslationVisible(visible) {
      document.body.classList.toggle('show-translation', visible);
      toggleTrBtn.setAttribute('aria-pressed', String(visible));
      toggleTrBtn.textContent = visible ? 'Hide translation' : 'Show translation';
    }

    function showToast(msg) {
      toast.textContent = msg;
      srStatus.textContent = msg; // screen readers
      toast.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove('show'), 1500);
    }

    async function loadData() {
      try {
        cons
